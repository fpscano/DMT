<script>
    /* JavaScript Logic - Updated to use CSV Link */
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSXwF-92T09SgCmFnFLk6NjAWwK52BxFpyivdtrFtFWv-c4DdrF1jgpgZg7jWsyASCqVP7TxyDKVuH4/pub?gid=1780048900&single=true&output=csv';

    async function updateFuelTank() {
      try {
        const response = await fetch(CSV_URL);
        const csvText = await response.text();
        
        // Split by lines and then by commas
        const rows = csvText.split('\n').map(row => row.split(','));

        // Based on your Sheet, Goal is H9 (index 7) and Actual is I9 (index 8)
        // We find the correct row (Row 9 is index 8 in a 0-based array)
        const targetRow = rows[8]; 
        
        if (!targetRow) {
          console.error('Row 9 not found in CSV.');
          return;
        }

        const cleanNum = (str) => {
            if (!str) return 0;
            return parseFloat(str.replace(/[^0-9.-]+/g, "")) || 0;
        };

        const goal = cleanNum(targetRow[7]);   // Column H
        const actual = cleanNum(targetRow[8]); // Column I
        
        const percentage = Math.round((actual / (goal || 1)) * 100);
        // Visual cap at 92% so waves don't fly out of the tank
        const visualHeight = percentage >= 95 ? 92 : percentage;

        document.getElementById('liquid-level').style.height = visualHeight + '%';
        document.getElementById('adr-percent').innerText = percentage;

        const actualElement = document.getElementById('adr-actual');
        const iconElement = document.getElementById('status-icon');
        const goalElement = document.getElementById('adr-goal');
        const mainContainer = document.getElementById('main-container');

        actualElement.innerText = '$' + actual.toLocaleString();
        goalElement.innerText = '$' + goal.toLocaleString();

        // Update Performance Colors & Classes
        if (actual > goal) {
          actualElement.parentElement.className = "actual-val status-over";
          mainContainer.className = "animation-container over-goal";
          iconElement.innerHTML = "▲"; 
        } else if (actual < goal) {
          actualElement.parentElement.className = "actual-val status-under";
          mainContainer.className = "animation-container under-goal";
          iconElement.innerHTML = "▼";
        } else {
          actualElement.parentElement.className = "actual-val status-met";
          mainContainer.className = "animation-container over-goal";
          iconElement.innerHTML = "=";
        }

      } catch (error) {
        console.error("Tank update failed:", error);
      }
    }

    updateFuelTank();
    // Auto-refresh every 5 minutes
    setInterval(updateFuelTank, 300000);
  </script>
