<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fuel Tank Analytics</title>
  <style>
    body {
      margin: 0;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    .animation-container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .fuel-tank {
      position: relative;
      width: 140px;
      height: 280px;
      background: #111;
      border: 4px solid #444;
      border-radius: 25px;
      overflow: hidden;
      box-shadow: 0 0 30px rgba(0,0,0,0.5);
    }

    .liquid {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 0%; 
      background: linear-gradient(to top, #d35400, #f1c40f);
      transition: height 1.5s ease-in-out, background 1s ease;
      overflow: visible;
    }

    /* Change colors based on performance classes */
    .under-goal .liquid { background: linear-gradient(to top, #922b21, #e74c3c); }
    .over-goal .liquid { background: linear-gradient(to top, #1e8449, #2ecc71); }
    .under-goal .wave-svg { fill: #e74c3c; }
    .over-goal .wave-svg { fill: #2ecc71; }

    .wave-svg {
      position: absolute;
      top: -18px;
      left: 0;
      width: 200%;
      height: 25px;
      fill: #f1c40f;
      animation: wave-slide 4s linear infinite;
      transition: fill 1s ease;
    }

    @keyframes wave-slide {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    .tank-label {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 20;
      color: white;
      font-family: Arial, sans-serif;
      font-size: 2rem;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    }

    .value-display {
      margin-top: 15px;
      font-family: Arial, sans-serif;
      text-align: center;
    }

    .actual-val { font-size: 1.5rem; font-weight: bold; color: #f1c40f; }
    .status-over { color: #2ecc71 !important; }
    .status-under { color: #e74c3c !important; }
    .status-met { color: #2ecc71 !important; }

    .goal-val { color: #888; font-size: 1.1rem; margin-top: 5px; }
    #status-icon { margin-left: 8px; font-size: 1.2rem; }

    .bubbles span {
      position: absolute;
      bottom: -20px;
      background: rgba(255, 255, 255, 0.4);
      border-radius: 50%;
      animation: rise var(--d) infinite;
      left: var(--l);
      width: var(--s);
      height: var(--s);
    }
    .bubbles span:nth-child(1) { --l: 15%; --s: 10px; --d: 3s; }
    .bubbles span:nth-child(2) { --l: 35%; --s: 15px; --d: 5s; }
    .bubbles span:nth-child(3) { --l: 55%; --s: 8px;  --d: 4s; }
    .bubbles span:nth-child(4) { --l: 75%; --s: 12px; --d: 6s; }
    .bubbles span:nth-child(5) { --l: 90%; --s: 10px; --d: 3.5s; }

    @keyframes rise {
      0% { transform: translateY(0); opacity: 0.8; }
      100% { transform: translateY(-280px); opacity: 0; }
    }
  </style>
</head>
<body>

  <div id="main-container" class="animation-container">
    <div class="fuel-tank">
      <div class="tank-label"><span id="adr-percent">0</span>%</div>
      
      <div id="liquid-level" class="liquid">
         <svg class="wave-svg" viewBox="0 0 200 20" preserveAspectRatio="none">
           <path d="M0 10 Q 25 0, 50 10 T 100 10 T 150 10 T 200 10 V 20 H 0 Z"></path>
         </svg>
         
         <div class="bubbles">
           <span></span><span></span><span></span><span></span><span></span>
         </div>
      </div>
    </div>
    
    <div class="value-display">
      <div class="actual-val">
        Actual: <span id="adr-actual">$0</span> 
        <span id="status-icon"></span>
      </div>
      <div class="goal-val">Monthly Goal: <span id="adr-goal">$0</span></div>
    </div>
  </div>

  <script>
    async function updateFuelTank() {
      const API_KEY = 'AIzaSyAGpCyqpw0isbwpVTSi2KfG3gpuGYu86F4';
      const SHEET_ID = '19sNWZ7NxHaE8Zjlzs57vZAKA_XBHBebPKAd59vUyjzc';
      const RANGE = 'ADR!H9:I9'; 

      try {
        const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`);
        const data = await response.json();
        
        if (!data.values) return;

        const cleanNum = (str) => parseFloat(str.replace(/[^0-9.-]+/g, ""));
        const goal = cleanNum(data.values[0][0]) || 1;
        const actual = cleanNum(data.values[0][1]) || 0;
        
        const percentage = Math.round((actual / goal) * 100);
        // Visual cap at 92% so waves don't fly out of the tank
        const visualHeight = percentage >= 95 ? 92 : percentage;

        document.getElementById('liquid-level').style.height = visualHeight + '%';
        document.getElementById('adr-percent').innerText = percentage;

        const actualElement = document.getElementById('adr-actual');
        const iconElement = document.getElementById('status-icon');
        const goalElement = document.getElementById('adr-goal');
        const mainContainer = document.getElementById('main-container');

        actualElement.innerText = '$' + actual.toLocaleString();
        goalElement.innerText = '$' + goal.toLocaleString();

        // Update Performance Colors & Classes
        if (actual > goal) {
          actualElement.parentElement.className = "actual-val status-over";
          mainContainer.className = "animation-container over-goal";
          iconElement.innerHTML = "▲"; 
        } else if (actual < goal) {
          actualElement.parentElement.className = "actual-val status-under";
          mainContainer.className = "animation-container under-goal";
          iconElement.innerHTML = "▼";
        } else {
          actualElement.parentElement.className = "actual-val status-met";
          mainContainer.className = "animation-container over-goal";
          iconElement.innerHTML = "=";
        }

      } catch (error) {
        console.error("Tank update failed:", error);
      }
    }

    updateFuelTank();
    // Auto-refresh every 5 minutes
    setInterval(updateFuelTank, 300000);
  </script>
</body>
</html>
