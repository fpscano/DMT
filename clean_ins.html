<div id="dynamic-bar-chart"></div>

<style>
  #dynamic-bar-chart {
    padding: 20px;
    background: #1e293b; /* Dark theme to match your screenshot */
    border-radius: 8px;
    color: white;
    font-family: 'Inter', sans-serif;
  }
  .bar-wrapper {
    margin-bottom: 15px;
  }
  .bar-label {
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: 5px;
    display: block;
  }
  .winner-label {
    color: #facc15; /* Gold for the top performer */
  }
  .bar-track {
    background: #334155;
    height: 24px;
    border-radius: 4px;
    width: 100%;
    overflow: hidden;
  }
  .bar-fill {
    height: 100%;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 10px;
    transition: width 1.5s cubic-bezier(0.1, 0.5, 0.5, 1); /* Animation effect */
  }
  .bar-value {
    font-size: 0.75rem;
    font-weight: 800;
  }
</style>

<script>
    /* JavaScript Logic - Updated to use CSV */
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSXwF-92T09SgCmFnFLk6NjAWwK52BxFpyivdtrFtFWv-c4DdrF1jgpgZg7jWsyASCqVP7TxyDKVuH4/pub?gid=0&single=true&output=csv';

    const terminalColors = {
      "Birmingham": "#facc15",
      "Scottsboro": "#84cc16",
      "Broken Bow": "#0ea5e9",
      "Starke": "#ef4444",
      "Camden": "#10b981"
    };

    async function fetchSheetData() {
      try {
        const response = await fetch(CSV_URL);
        const csvText = await response.text();
        
        // Clean up quotes and split rows correctly
        const rows = csvText.trim().split('\n').map(row => 
          row.split(',').map(cell => cell.replace(/"/g, '').trim())
        );

        if (!rows || rows.length <= 1) {
          console.error('No data found in CSV.');
          return;
        }

        const chartData = rows.slice(1).map(row => ({
          terminal: row[0],
          value: parseInt(row[1]) || 0
        })).filter(item => item.terminal !== "");

        renderChart(chartData);
      } catch (error) {
        console.error('Error fetching CSV data:', error);
      }
    }

    function renderChart(data) {
      const container = document.getElementById('dynamic-bar-chart');
      if (!container) return;
      container.innerHTML = ''; 
      
      const maxValue = Math.max(...data.map(d => d.value), 1);

      data.forEach(item => {
        const isWinner = item.value === maxValue && maxValue > 0;
        const widthPercentage = (item.value / maxValue) * 100;
        const color = terminalColors[item.terminal] || "#64748b";

        const barHtml = `
          <div class="bar-wrapper">
            <div class="bar-label ${isWinner ? 'winner-label' : ''}">${item.terminal}</div>
            <div class="bar-track">
              <div class="bar-fill" 
                   style="width: 0%; background-color: ${color};" 
                   data-width="${widthPercentage}%">
                <span class="bar-value">${item.value}</span>
              </div>
            </div>
          </div>
        `;
        container.innerHTML += barHtml;
      });

      // Triggers the slide-out animation after rendering
      setTimeout(() => {
        document.querySelectorAll('.bar-fill').forEach(bar => {
          bar.style.width = bar.getAttribute('data-width');
        });
      }, 100);
    }

    fetchSheetData();
</script>
