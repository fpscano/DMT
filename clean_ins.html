<script>
    /* JavaScript Logic - Updated to use CSV */
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSXwF-92T09SgCmFnFLk6NjAWwK52BxFpyivdtrFtFWv-c4DdrF1jgpgZg7jWsyASCqVP7TxyDKVuH4/pub?gid=0&single=true&output=csv';

    const terminalColors = {
      "Birmingham": "#facc15",
      "Scottsboro": "#84cc16",
      "Broken Bow": "#0ea5e9",
      "Starke": "#ef4444",
      "Camden": "#10b981"
    };

    async function fetchSheetData() {
      try {
        const response = await fetch(CSV_URL);
        const csvText = await response.text();
        
        // Simple CSV Parser: splits by line, then by comma
        const rows = csvText.split('\n').map(row => row.split(','));

        if (!rows || rows.length <= 1) {
          console.error('No data found in CSV.');
          return;
        }

        // Slice(1) skips the header row
        const chartData = rows.slice(1).map(row => ({
          terminal: row[0].trim(),
          value: parseInt(row[1]) || 0
        })).filter(item => item.terminal !== ""); // filter out empty rows

        renderChart(chartData);
      } catch (error) {
        console.error('Error fetching CSV data:', error);
      }
    }

    function renderChart(data) {
      const container = document.getElementById('dynamic-bar-chart');
      container.innerHTML = ''; 
      
      const maxValue = Math.max(...data.map(d => d.value), 1);

      data.forEach(item => {
        const isWinner = item.value === maxValue && maxValue > 0;
        const widthPercentage = (item.value / maxValue) * 100;
        const color = terminalColors[item.terminal] || "#64748b";

        const barHtml = `
          <div class="bar-wrapper">
            <div class="bar-label ${isWinner ? 'winner-label' : ''}">${item.terminal}</div>
            <div class="bar-track">
              <div class="bar-fill ${isWinner ? 'winner-bar' : ''}" 
                   style="width: 0%; background-color: ${color};" 
                   data-width="${widthPercentage}%">
                <span class="bar-value">${item.value}</span>
              </div>
            </div>
          </div>
        `;
        container.innerHTML += barHtml;
      });

      setTimeout(() => {
        document.querySelectorAll('.bar-fill').forEach(bar => {
          bar.style.width = bar.getAttribute('data-width');
        });
      }, 100);
    }

    fetchSheetData();
  </script>
